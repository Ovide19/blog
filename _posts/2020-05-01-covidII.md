---
layout: posts
title: Mapping COVID-19 statistics using Folium and pandas - Part II
published: true
header:
  overlay_image: /assets/images/map_overlay.jpg
  overlay_filter: 0.2
tags: [flask, heroku, folium]
---

Now that our Covid-19 map is up and running, let's create a Heroku-hosted flask app to make it available online.

### 1. Adding an html legend to the map

Before publishing our map, let's add some extra information on top of it, such as the data provenance.
In order to do this, let's create an html legend. We can do this right after the import statements:
 
```python
legend_html = '''
<div style="position: fixed;
     padding: .5em; top: 10px; left: 60px; width: 30em; height: 10em;
     border:2px solid grey; z-index:9999; font-size:14px; background: #eee;
     "> &nbsp; COVID-19 related deaths for Metropolitan France<br>
     &nbsp; Data recovered from https://github.com/opencovid19-fr/data  <br>
</div>
'''
```

Upon instantiation of the `CovidData` class, we can easily display this legend using:

```python
CODA.map.get_root().html.add_child(folium.Element(legend_html))
```

Our `create_map` function now looks like this:

```python
def create_map():
     CODA=CovidData()
     CODA.merge_data_and_coordinates()
     CODA.drop_rows_with_missing_info()
     CODA.select_last_date()
     CODA.plot_departments(CODA.merged_data_last,'grey')
     CODA.map.get_root().html.add_child(folium.Element(legend_html))
     colormap.caption = 'COVID-19 death toll per department (Source: opencovid19-fr)'
     CODA.map.add_child(colormap)
     return CODA
```

### 2. Creating a flask app

With the legend out of the way, let's now create a web app to display our map. This is where [Flask](https://flask.palletsprojects.com/en/1.1.x/) steps in. Flask is a python web microframework. When I first stumbled onto Flask, I wondered what the "micro" in microframework meant: it turns out that flask is designed to be simple but extensible... *One drop at a time*! 

No big surprise here: the first thing to do is to import `flask`:

```python
from flask import Flask
```

We can now comment out the code line use to export our map to an html file, as we won't need it anymore:

```python
#Coda.map.save("./COVID_map.html")
```

Instead, let's append the following code block at the end of our script:

```python
app = Flask(__name__)

@app.route("/")
def display_map():
     CODA = create_map()
     return CODA.map._repr_html_()

if __name__ == '__main__':
    app.run(debug=True)
```






### 3. Hosting the app on heroku

